---
title: "Data Translation Project - Econometrics WQ22"
author: "Oliver Hering, Bethany Locke, Zack Carey, Jenna Maeda"
date: "3/4/2022"
output: html_document
---

1. How has COVID affected the health of the retail industry, as measured by employment?
2. How has retail fared relative to other industries?
3. Retail needs to worry about who has money to spend - what has changed about who is working and earning money?


```{r}
library(haven)
library(tidyverse)
library(ipumsr)
library(lubridate)
library(jtools)
library(vtable)
library(fixest)
```

# Reading in the Data
```{r}
ddi <- read_ipums_ddi("cps_00001.xml")
data <- read_ipums_micro(ddi)
```

# Joining the indnames file to the data to put names to the industry codes
```{r}
indnames <- read.csv('indnames.csv', header = TRUE)

data <- left_join(x = data, y = indnames, by = c('IND' = 'ind'))

data <- data %>%
  relocate(indname, .after = IND)
```



# Adding a binary variable that is 0 before covid and 1 after/during covid
```{r}
# combining year and month into one column called 'date'
data <- data %>%
  relocate(MONTH, .after = YEAR)

data <- data %>%
  mutate(date = paste0(YEAR, '-', MONTH, '-01')) %>%
  mutate(date = ymd(date)) %>%
  relocate(date, .after = MONTH)


# creating the binary variable
data$covid <- ifelse(data$date >= '2020-03-01', 1, 0)

data <- data %>%
  relocate(covid, .after = date)


# checking to make sure its right
grouped_dates <- data %>%
  group_by(date) %>%
  summarise(mean(covid))
```

# Question 1: How has COVID affected the health of the retail industry, as measured by employment?
```{r}
#selecting only retail trade workers
q1data <- data %>%
  filter(indname == 'Retail Trade') %>%
  select(date, covid, EMPSTAT)

q1data %>% count(EMPSTAT)

#binary variable for if employed (1) or not (0).
q1data$employed <- ifelse(q1data$EMPSTAT == 10, 1, 0)

m1 <- lm(employed ~ covid, data = q1data)
export_summs(m1, digits = 3)
```

# Question 2: How has retail fared relative to other industries?
```{r}
#binary variable for if the industry is retail (1) or not (0)
data$retail_industry <- ifelse(data$indname == 'Retail Trade', 1, 0)

data <- data %>%
  relocate(retail_industry, .after = indname)

data$employed <- ifelse(data$EMPSTAT == 10, 1, 0)

#regular regression model
m2 <- lm(employed ~ covid*retail_industry, data = data)

#fixed effects regression model
m2feols <- feols(employed ~ covid:retail_industry | indname + date, data = data)


export_summs(m2, m2feols, digits = 3)
```

# Question 3: Retail needs to worry about who has money to spend - what has changed about who is working and earning money?
```{r}

```